(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;b=a.WebSocketExample=a.WebSocketExample||{};c=b.TalkingInfo=b.TalkingInfo||{};d=b.SmallTalkProcess=b.SmallTalkProcess||{};e=a.WebSocketExample_Templates=a.WebSocketExample_Templates||{};f=a.WebSocketExample_JsonEncoder=a.WebSocketExample_JsonEncoder||{};g=a.WebSocketExample_JsonDecoder=a.WebSocketExample_JsonDecoder||{};h=a.WebSharper;i=h&&h.Concurrency;j=a.JSON;k=h&&h.ClientSideJson;l=k&&k.Provider;m=h&&h.JavaScript;n=m&&m.Promise;o=h&&h.AspNetCore;p=o&&o.WebSocket;q=p&&p.Client;r=q&&q.WithEncoding;s=a.console;t=h&&h.UI;u=t&&t.Templating;v=u&&u.Runtime;w=v&&v.Server;x=w&&w.ProviderBuilder;y=w&&w.Handler;z=w&&w.TemplateInstance;A=t&&t.Client;B=A&&A.Templates;c.New=function(C,D){return{username:C,content:D};};d.ProcessBinding$44$25=function(C){return function(D){var E;i.StartImmediate((E=null,i.Delay(function(){var F;F=c.New("someone",D.Vars.Hole("talkingcontent").$1.Get());C.$0.Post({$:0,$0:j.stringify(((l.Id())())(F))});return i.Zero();})),null);};};d.ProcessBinding=function(C){var D,E,F,G,H,I;D=null;n.OfAsync((E=null,i.Delay(function(){return r.ConnectStateful(function(J){return j.stringify((f.j$1())(J));},function(J){return(g.j())(j.parse(J));},C,function(){var J;J=null;return i.Delay(function(){return i.Return([0,function(K){return function(L){var M;M=null;return i.Delay(function(){var N,O;return L.$==0?i.Combine((N=self.document.getElementById("TalkingList"),(O=self.document.createElement("li"),(O.appendChild(self.document.createTextNode(L.$0.$0)),O.setAttribute("class","list-group-item"),N.appendChild(O),i.Zero()))),i.Delay(function(){return i.Return(K+1);})):L.$==3?(s.log("WebSocket Connection Close"),i.Return(K)):L.$==1?(s.log("WebSocket Connection Error"),i.Return(K)):(s.log("WebSocket Connection Open"),i.Return(K));});};}]);});});}))).then(function(J){D={$:1,$0:J};});return(F=(G=new x.New$1(),(G.h.push(y.EventQ2(G.k,"sendtalking",function(){return G.i;},function(J){var K;i.StartImmediate((K=null,i.Delay(function(){var L;L=c.New("someone",J.Vars.Hole("talkingcontent").$1.Get());D.$0.Post({$:0,$0:j.stringify(((l.Id())())(L))});return i.Zero();})),null);})),G)),(H=y.CompleteHoles(F.k,F.h,[["talkingcontent",0]]),(I=new z.New(H[1],e.talkingroom(H[0])),F.i=I,I))).get_Doc();};e.talkingroom=function(C){B.LoadLocalTemplates("smalltalk");return C?B.NamedTemplate("smalltalk",{$:1,$0:"talkingroom"},C):void 0;};f.j$1=function(){return f._v$1?f._v$1:f._v$1=(l.EncodeUnion(void 0,{content:0},[["Speak",[["$0","content",l.Id(),0]]]]))();};g.j=function(){return g._v?g._v:g._v=(l.DecodeUnion(void 0,{value:0},[["Broadcast",[["$0","value",l.Id(),0]]]]))();};}(self));
